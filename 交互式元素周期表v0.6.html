<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¤äº’å¼å…ƒç´ å‘¨æœŸè¡¨V0.6</title>
    <style>
        :root {
            --border-color: #cbd5e0;
            --box-size: 72px;
            /* ç¨å¾®æ”¾å¤§æ ¼å­ä»¥å®¹çº³æ±‰å­— */
            --gap-size: 4px;
            --table-width: calc(18 * var(--box-size) + 17 * var(--gap-size));
            --period-label-width: 32px;
            --side-col-width: var(--box-size);
            --side-cols-width: calc(2 * var(--side-col-width) + var(--gap-size));
            --label-height: 28px;
            --container-width: calc(var(--table-width) + var(--period-label-width) + var(--side-cols-width) + 90px);
            --bg-color: #f7fafc;
            --card-bg: #ffffff;
            --hover-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            --reveal-bg: #f0fff4;
            /* æ­æ™“åçš„èƒŒæ™¯ */
            --mark-bg: #fecaca;
            /* é‡ç‚¹æ ‡è®°èƒŒæ™¯ */

            /* åˆ†åŒºé¢œè‰² (é»˜è®¤æ·¡é›…è‰²è°ƒ) */
            --s-block: #d1f0c6;
            --p-block: #e6f4d8;
            --d-block: #f9e2a8;
            --f-block: #f6c6cf;
            --ds-block: #f3c98b;
            --noble-block: #c7ddff;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans SC", sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: var(--bg-color);
            margin: 0;
            padding: 16px;
            color: #2d3748;
            user-select: none;
        }

        .top-row {
            display: flex;
            gap: 10px;
            width: var(--container-width);
            align-items: stretch;
            margin-bottom: 10px;
            flex-wrap: nowrap;
            padding: 0 20px;
            box-sizing: border-box;
        }

        /* æ§åˆ¶é¢æ¿ */
        .controls {
            margin-bottom: 0;
            background: white;
            padding: 10px 12px;
            border-radius: 16px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
            display: flex;
            gap: 8px;
            flex-wrap: nowrap;
            justify-content: center;
            border: 1px solid #edf2f7;
            flex: 0 0 70%;
            box-sizing: border-box;
            align-self: stretch;
        }

        .control-group {
            display: flex;
            gap: 6px;
            padding: 0 6px;
            border-right: 1px solid #edf2f7;
            align-items: center;
            flex-wrap: nowrap;
        }

        .control-group:last-child {
            border-right: none;
        }

        .control-label {
            font-size: 12px;
            color: #718096;
            font-weight: bold;
            margin-right: 5px;
        }

        button {
            padding: 6px 10px;
            cursor: pointer;
            background-color: #fff;
            color: #4a5568;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 12px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 4px;
            font-weight: 500;
        }

        button:hover {
            background-color: #edf2f7;
            border-color: #cbd5e0;
            transform: translateY(-1px);
        }

        button.active {
            background-color: #ebf8ff;
            border-color: #4299e1;
            color: #2b6cb0;
            box-shadow: 0 0 0 1px #4299e1 inset;
        }

        select {
            padding: 6px 8px;
            cursor: pointer;
            background-color: #fff;
            color: #4a5568;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            font-size: 11px;
            transition: all 0.2s;
            font-weight: 500;
        }

        select:hover {
            background-color: #edf2f7;
            border-color: #cbd5e0;
        }

        /* å‘¨æœŸè¡¨å®¹å™¨ */
        .periodic-table-container {
            position: relative;
            background: white;
            padding: 30px;
            border-radius: 20px;
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
            width: var(--container-width);
            box-sizing: border-box;
        }

        .periodic-table {
            display: grid;
            grid-template-columns: repeat(18, var(--box-size));
            grid-template-rows: repeat(10, var(--box-size));
            gap: var(--gap-size);
            margin-bottom: 20px;
            margin-top: calc(var(--label-height) + var(--gap-size));
        }

        .table-grid {
            display: grid;
            grid-template-columns: var(--period-label-width) var(--table-width) var(--side-cols-width);
            row-gap: 0;
            column-gap: 6px;
        }

        .table-stack {
            position: relative;
            width: var(--table-width);
            height: calc(10 * var(--box-size) + 9 * var(--gap-size) + var(--label-height) + var(--gap-size));
        }

        .group-labels {
            position: absolute;
            inset: 0;
            pointer-events: none;
        }

        .group-label {
            position: absolute;
            width: var(--box-size);
            height: var(--label-height);
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            color: #4a5568;
            background: #ffffff;
            box-sizing: border-box;
            left: calc((var(--col) - 1) * (var(--box-size) + var(--gap-size)));
            top: calc((var(--row) - 1) * (var(--box-size) + var(--gap-size)));
        }

        .group-num {
            font-size: 12px;
            line-height: 1;
            color: #2d3748;
        }

        .group-old {
            font-size: 11px;
            line-height: 1.1;
            color: #718096;
        }

        .period-labels {
            display: grid;
            grid-template-rows: repeat(7, var(--box-size));
            gap: var(--gap-size);
            margin-top: calc(var(--label-height) + var(--gap-size));
        }

        .period-label {
            display: flex;
            align-items: center;
            justify-content: center;
            height: var(--box-size);
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            font-size: 13px;
            color: #4a5568;
            background: #ffffff;
            box-sizing: border-box;
        }

        .period-label.is-empty {
            border-color: transparent;
            background: transparent;
        }
        .side-labels {
            display: grid;
            grid-template-columns: repeat(2, var(--side-col-width));
            gap: var(--gap-size);
            grid-auto-rows: var(--box-size);
        }

        .side-headers {
            display: grid;
            grid-template-columns: repeat(2, var(--side-col-width));
            gap: var(--gap-size);
            position: absolute;
            top: 0;
            left: 0;
        }

        .side-header {
            height: var(--label-height);
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            color: #4a5568;
            background: #ffffff;
            text-align: center;
            padding: 0 2px;
            box-sizing: border-box;
        }

        .side-cell {
            height: var(--box-size);
            border: 1px solid #e2e8f0;
            border-radius: 6px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 13px;
            color: #4a5568;
            background: #ffffff;
            box-sizing: border-box;
        }

        .side-cell.multiline {
            font-size: 9px;
            line-height: 1.05;
            text-align: center;
            padding: 1px 2px;
        }
        .side-column {
            position: relative;
            width: var(--side-cols-width);
            height: calc(7 * var(--box-size) + 6 * var(--gap-size) + var(--label-height) + var(--gap-size));
        }
        
        .side-labels {
            margin-top: calc(var(--label-height) + var(--gap-size));
        }
        /* å…ƒç´ æ ¼å­ */
        .element {
            border: 1px solid var(--border-color);
            border-radius: 6px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            background: var(--card-bg);
            box-sizing: border-box;
            height: 100%;
            width: 100%;
            cursor: pointer;
            transition: transform 0.15s ease, box-shadow 0.15s ease, background-color 0.2s;
        }

        .element:hover {
            z-index: 10;
            box-shadow: var(--hover-shadow);
            transform: scale(1.1);
            border-color: #a0aec0;
        }

        /* çŠ¶æ€æ ·å¼ */
        .element.is-revealed {
            background-color: var(--reveal-bg);
            border-color: #9ae6b4;
        }

        .element.is-marked {
            background-color: var(--mark-bg);
            border-color: #f56565;
        }

        .element.is-marked.is-revealed {
            background-color: #fecaca;
        }

        .element.is-selected {
            border-color: #3182ce;
            box-shadow: 0 0 0 2px rgba(49, 130, 206, 0.35), 0 6px 14px rgba(49, 130, 206, 0.25);
        }

        /* æ··åˆè‰² */

        /* å†…å®¹å…ƒç´  */
        .atomic-number {
            position: absolute;
            top: 2px;
            left: 3px;
            font-size: 11px;
            color: #718096;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .symbol {
            font-size: 20px;
            font-weight: 700;
            color: #2d3748;
            line-height: 1.1;
            opacity: 0;
            transition: opacity 0.2s;
        }

        .hanzi {
            font-size: 14px;
            color: #4a5568;
            margin-top: 1px;
            opacity: 0;
            transition: opacity 0.2s;
        }

        /* æ˜¾éšé€»è¾‘ */
        /* å…¨å±€å¼€å…³ */
        .show-number .atomic-number {
            opacity: 1;
        }

        .show-symbol .symbol {
            opacity: 1;
        }

        .show-hanzi .hanzi {
            opacity: 1;
        }

        /* å•ä¸ªæ­æ™“ (æœ€é«˜ä¼˜å…ˆçº§) */
        .element.is-revealed .atomic-number,
        .element.is-revealed .symbol,
        .element.is-revealed .hanzi {
            opacity: 1 !important;
        }

        /* é˜¶æ¢¯çº¿ */
        .show-staircase .element[data-stair="true"] {
            border-bottom: 3px solid #f56565;
            border-right: 3px solid #f56565;
        }

        /* åˆ†åŒºç€è‰²æ¨¡å¼ */
        .show-zones .element[data-block="s"] {
            background-color: var(--s-block);
        }

        .show-zones .element[data-block="p"] {
            background-color: var(--p-block);
        }

        .show-zones .element[data-block="d"] {
            background-color: var(--d-block);
        }

        .show-zones .element[data-block="ds"] {
            background-color: var(--ds-block);
        }

        .show-zones .element[data-block="f"] {
            background-color: var(--f-block);
        }

        .show-zones .element[data-group="18"] {
            background-color: var(--noble-block);
        }

        /* ä¿æŒæ ‡è®°çš„é«˜äº®è¦†ç›–åˆ†åŒºè‰² */
        .show-zones .element.is-marked {
            background-color: var(--mark-bg) !important;
        }

        .show-zones .element.is-revealed {
            filter: brightness(0.95);
        }

        /* æ­æ™“æ—¶ç¨å¾®å˜æš—ä¸€ç‚¹ç‚¹ä»¥ç¤ºåŒºåˆ« */

        /* æ‰¹æ³¨åŒº */
        .teaching-notes {
            margin-top: 10px;
            width: 100%;
            box-sizing: border-box;
            border: 2px dashed #e2e8f0;
            padding: 20px;
            border-radius: 12px;
            background: #f8fafc;
            color: #4a5568;
            min-height: 60px;
        }

        .teaching-notes:focus-within {
            border-color: #4299e1;
            background: #fff;
        }

        .series-label {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            padding-right: 8px;
            font-size: 11px;
            color: #718096;
            font-weight: 500;
        }

        /* æç¤ºæ  */
        .status-bar {
            display: flex;
            justify-content: space-between;
            width: var(--container-width);
            margin-bottom: 10px;
            font-size: 13px;
            color: #718096;
        }

        .legend-panel {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            flex: 0 0 30%;
            margin-bottom: 0;
            box-sizing: border-box;
            align-items: stretch;
            align-self: stretch;
        }

        .legend-panel .legend-box {
            height: 100%;
            box-sizing: border-box;
        }

        .legend-box {
            background: #ffffff;
            border: 1px solid #edf2f7;
            border-radius: 16px;
            padding: 10px 12px;
            color: #4a5568;
            box-sizing: border-box;
            flex: 1;
            display: flex;
            flex-direction: column;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .legend-title {
            font-size: 12px;
            font-weight: 700;
            color: #2d3748;
            margin-bottom: 6px;
        }

        .info-bar {
            display: flex;
            justify-content: space-between;
            gap: 12px;
            flex-wrap: wrap;
            width: var(--container-width);
            margin-bottom: 10px;
            font-size: 18px;
            color: #4a5568;
            background: #ffffff;
            border: 1px solid #edf2f7;
            border-radius: 12px;
            padding: 10px 14px;
            box-sizing: border-box;
        }

        .info-bar .label {
            color: #2d3748;
            font-weight: 600;
        }

        .info-bar .config {
            font-size: 20px;
            font-weight: 600;
            line-height: 1.6;
        }

        .info-bar .config sup {
            font-size: 0.7em;
            vertical-align: super;
        }

        .info-bar .orbital {
            white-space: nowrap;
        }

        .quiz-target {
            font-weight: 700;
            color: #2b6cb0;
            padding: 0 4px;
        }

        .quiz-score {
            font-size: 13px;
            color: #718096;
        }

        .quiz-result {
            font-weight: 600;
        }

        .quiz-result.is-correct {
            color: #2f855a;
        }

        .quiz-result.is-wrong {
            color: #c53030;
        }

        .legend span {
            margin-left: 15px;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            display: inline-block;
        }

        .info-note {
            font-size: 12px;
            color: #a0aec0;
        }
    </style>
</head>

<body>

    <div class="top-row">
        <div class="controls">
            <div class="control-group">
                <span class="control-label">æç¤º</span>
                <button id="btn-num" onclick="toggleGlobal('number')">ğŸ”¢ åºå·</button>
                <button id="btn-zones" onclick="toggleGlobal('zones')">ğŸ¨ åˆ†åŒº (s/p/d/f)</button>
                <button id="btn-stair" onclick="toggleGlobal('staircase')">ğŸ“‰ é‡‘å±åˆ†ç•Œ</button>
            </div>

            <div class="control-group">
                <span class="control-label">ç­”æ¡ˆ</span>
                <button id="btn-sym" onclick="toggleGlobal('symbol')">ğŸ”  ç¬¦å·</button>
                <button id="btn-hanzi" onclick="toggleGlobal('hanzi')">ğŸ‡¨ğŸ‡³ æ±‰å­—</button>
            </div>

            <div class="control-group">
                <span class="control-label">å­¦ä¹ </span>
                <button id="btn-quiz" onclick="toggleQuiz()">ğŸ§ª å¼€å§‹å­¦ä¹ </button>
                <select id="quiz-mode" onchange="setQuizMode(this.value)">
                    <option value="random_all">éšæœºï¼ˆå…¨å…ƒç´ ï¼‰</option>
                    <option value="symbol_all">åªé—®ç¬¦å·ï¼ˆå…¨å…ƒç´ ï¼‰</option>
                    <option value="hanzi_all">åªé—®æ±‰å­—ï¼ˆå…¨å…ƒç´ ï¼‰</option>
                    <option value="common_random">å¸¸ç”¨å…ƒç´ ï¼ˆéšæœºï¼‰</option>
                </select>
            </div>

            <div class="control-group">
                <button onclick="resetTable()" style="color: #e53e3e; border-color: #e53e3e;">ğŸ—‘ï¸ é‡ç½®</button>
            </div>
        </div>
        <div class="legend-panel">
            <div class="legend-box">
                <div class="legend-title">åˆ†åŒºé¢œè‰² / ç¨€æœ‰æ°”ä½“</div>
                <div class="legend">
                    <span><i class="dot" style="background:var(--s-block)"></i> såŒº</span>
                    <span><i class="dot" style="background:var(--p-block)"></i> påŒº</span>
                    <span><i class="dot" style="background:var(--d-block)"></i> dåŒº</span>
                    <span><i class="dot" style="background:var(--ds-block)"></i> dsåŒº</span>
                    <span><i class="dot" style="background:var(--f-block)"></i> fåŒº</span>
                    <span><i class="dot" style="background:var(--noble-block)"></i> ç¨€æœ‰æ°”ä½“</span>
                </div>
            </div>
        </div>
    </div>

    <div class="status-bar">
        <div class="instructions">ğŸ–±ï¸ å·¦é”®ï¼šæ­æ™“å•æ ¼ | å³é”®ï¼šæ ‡è®°éš¾ç‚¹</div>
    </div>

    <div class="info-bar" id="info-bar">
        <div><span class="label">å…ƒç´ è¯¦æƒ…ï¼š</span>ç‚¹å‡»ä»»ä¸€å…ƒç´ æŸ¥çœ‹ç”µå­æ’å¸ƒã€æ—åºæ•°å’Œå‘¨æœŸåºæ•°</div>
        <div class="info-note">ç”µå­æ’å¸ƒä½¿ç”¨å…¨å…ƒç´ æ•°æ®è¡¨ï¼Œé€‚åˆè¯¾å ‚å±•ç¤º</div>
    </div>

    <div class="periodic-table-container">
        <div class="table-grid">
            <div class="period-labels">
                <div class="period-label">1</div>
                <div class="period-label">2</div>
                <div class="period-label">3</div>
                <div class="period-label">4</div>
                <div class="period-label">5</div>
                <div class="period-label">6</div>
                <div class="period-label">7</div>
            </div>

            <div class="table-stack">
                <div class="group-labels">
                    <div class="group-label" style="--col:1;--row:1"><span class="group-num">1</span><span class="group-old">IA</span></div>
                    <div class="group-label" style="--col:2;--row:2"><span class="group-num">2</span><span class="group-old">IIA</span></div>
                    <div class="group-label" style="--col:3;--row:4"><span class="group-num">3</span><span class="group-old">IIIB</span></div>
                    <div class="group-label" style="--col:4;--row:4"><span class="group-num">4</span><span class="group-old">IVB</span></div>
                    <div class="group-label" style="--col:5;--row:4"><span class="group-num">5</span><span class="group-old">VB</span></div>
                    <div class="group-label" style="--col:6;--row:4"><span class="group-num">6</span><span class="group-old">VIB</span></div>
                    <div class="group-label" style="--col:7;--row:4"><span class="group-num">7</span><span class="group-old">VIIB</span></div>
                    <div class="group-label" style="--col:8;--row:4"><span class="group-num">8</span><span class="group-old">VIII</span></div>
                    <div class="group-label" style="--col:9;--row:4"><span class="group-num">9</span><span class="group-old">VIII</span></div>
                    <div class="group-label" style="--col:10;--row:4"><span class="group-num">10</span><span class="group-old">VIII</span></div>
                    <div class="group-label" style="--col:11;--row:4"><span class="group-num">11</span><span class="group-old">IB</span></div>
                    <div class="group-label" style="--col:12;--row:4"><span class="group-num">12</span><span class="group-old">IIB</span></div>
                    <div class="group-label" style="--col:13;--row:2"><span class="group-num">13</span><span class="group-old">IIIA</span></div>
                    <div class="group-label" style="--col:14;--row:2"><span class="group-num">14</span><span class="group-old">IVA</span></div>
                    <div class="group-label" style="--col:15;--row:2"><span class="group-num">15</span><span class="group-old">VA</span></div>
                    <div class="group-label" style="--col:16;--row:2"><span class="group-num">16</span><span class="group-old">VIA</span></div>
                    <div class="group-label" style="--col:17;--row:2"><span class="group-num">17</span><span class="group-old">VIIA</span></div>
                    <div class="group-label" style="--col:18;--row:1"><span class="group-num">18</span><span class="group-old">0</span></div>
                </div>

                <div class="periodic-table" id="table">
                    <!-- JS ç”Ÿæˆ -->
                </div>
            </div>

            <div class="side-column">
                <div class="side-headers">
                    <div class="side-header">ç”µå­å±‚</div>
                    <div class="side-header">0æ—ç”µå­æ•°</div>
                </div>
                <div class="side-labels">
                    <div class="side-cell multiline">K</div>
                    <div class="side-cell multiline">2</div>
                    <div class="side-cell multiline">K<br>L</div>
                    <div class="side-cell multiline">2<br>8</div>
                    <div class="side-cell multiline">K<br>L<br>M</div>
                    <div class="side-cell multiline">2<br>8<br>8</div>
                    <div class="side-cell multiline">K<br>L<br>M<br>N</div>
                    <div class="side-cell multiline">2<br>8<br>18<br>8</div>
                    <div class="side-cell multiline">K<br>L<br>M<br>N<br>O</div>
                    <div class="side-cell multiline">2<br>8<br>18<br>18<br>8</div>
                    <div class="side-cell multiline">K<br>L<br>M<br>N<br>O<br>P</div>
                    <div class="side-cell multiline">2<br>8<br>18<br>32<br>18<br>8</div>
                    <div class="side-cell multiline">K<br>L<br>M<br>N<br>O<br>P<br>Q</div>
                    <div class="side-cell multiline">2<br>8<br>18<br>32<br>32<br>18<br>8</div>
                </div>
            </div>
        </div>

        <div class="teaching-notes" contenteditable="true">
            <div style="font-weight:bold; margin-bottom:5px;">ğŸ“ è¯¾å ‚æ¿ä¹¦ / ä»»åŠ¡å‘å¸ƒåŒº:</div>
            1. å¼€å¯â€œæ±‰å­—â€å¼€å…³ï¼Œå°è¯•é»˜å†™å¯¹åº”çš„åŒ–å­¦ç¬¦å·ã€‚<br>
            2. å¼€å¯â€œåˆ†åŒºâ€åŠŸèƒ½ï¼Œè§‚å¯Ÿè¿‡æ¸¡é‡‘å±ï¼ˆdåŒºï¼‰çš„ä½ç½®åˆ†å¸ƒã€‚<br>
            3. å³é”®æ ‡è®°å‡ºæ‰€æœ‰çš„â€œç¨€æœ‰æ°”ä½“â€ã€‚
        </div>
    </div>

    <script>
        // æ•°æ®æ ¼å¼: [åºæ•°, ç¬¦å·, æ±‰å­—, è¡Œ, åˆ—, åˆ†åŒº(s/p/d/f), æ˜¯å¦ä¸ºé‡‘å±åˆ†ç•Œç‚¹]
        // såŒº: 1, 2åˆ—; påŒº: 13-18åˆ—(å«He); dåŒº: 3-12åˆ—; dsåŒº: ç¬¬11-12åˆ—; fåŒº: é•§ç³»é”•ç³»
        const elementsData = [
            [1, "H", "æ°¢", 1, 1, "s"], [2, "He", "æ°¦", 1, 18, "p"],
            [3, "Li", "é”‚", 2, 1, "s"], [4, "Be", "é“", 2, 2, "s"], [5, "B", "ç¡¼", 2, 13, "p", true], [6, "C", "ç¢³", 2, 14, "p"], [7, "N", "æ°®", 2, 15, "p"], [8, "O", "æ°§", 2, 16, "p"], [9, "F", "æ°Ÿ", 2, 17, "p"], [10, "Ne", "æ°–", 2, 18, "p"],
            [11, "Na", "é’ ", 3, 1, "s"], [12, "Mg", "é•", 3, 2, "s"], [13, "Al", "é“", 3, 13, "p", true], [14, "Si", "ç¡…", 3, 14, "p", true], [15, "P", "ç£·", 3, 15, "p"], [16, "S", "ç¡«", 3, 16, "p"], [17, "Cl", "æ°¯", 3, 17, "p"], [18, "Ar", "æ°©", 3, 18, "p"],
            [19, "K", "é’¾", 4, 1, "s"], [20, "Ca", "é’™", 4, 2, "s"], [21, "Sc", "é’ª", 4, 3, "d"], [22, "Ti", "é’›", 4, 4, "d"], [23, "V", "é’’", 4, 5, "d"], [24, "Cr", "é“¬", 4, 6, "d"], [25, "Mn", "é”°", 4, 7, "d"], [26, "Fe", "é“", 4, 8, "d"], [27, "Co", "é’´", 4, 9, "d"], [28, "Ni", "é•", 4, 10, "d"], [29, "Cu", "é“œ", 4, 11, "ds"], [30, "Zn", "é”Œ", 4, 12, "ds"], [31, "Ga", "é•“", 4, 13, "p"], [32, "Ge", "é”—", 4, 14, "p", true], [33, "As", "ç ·", 4, 15, "p", true], [34, "Se", "ç¡’", 4, 16, "p"], [35, "Br", "æº´", 4, 17, "p"], [36, "Kr", "æ°ª", 4, 18, "p"],
            [37, "Rb", "é“·", 5, 1, "s"], [38, "Sr", "é”¶", 5, 2, "s"], [39, "Y", "é’‡", 5, 3, "d"], [40, "Zr", "é”†", 5, 4, "d"], [41, "Nb", "é“Œ", 5, 5, "d"], [42, "Mo", "é’¼", 5, 6, "d"], [43, "Tc", "é”", 5, 7, "d"], [44, "Ru", "é’Œ", 5, 8, "d"], [45, "Rh", "é“‘", 5, 9, "d"], [46, "Pd", "é’¯", 5, 10, "d"], [47, "Ag", "é“¶", 5, 11, "ds"], [48, "Cd", "é•‰", 5, 12, "ds"], [49, "In", "é“Ÿ", 5, 13, "p"], [50, "Sn", "é”¡", 5, 14, "p"], [51, "Sb", "é”‘", 5, 15, "p", true], [52, "Te", "ç¢²", 5, 16, "p", true], [53, "I", "ç¢˜", 5, 17, "p"], [54, "Xe", "æ°™", 5, 18, "p"],
            [55, "Cs", "é“¯", 6, 1, "s"], [56, "Ba", "é’¡", 6, 2, "s"],
        /* é•§ç³»å ä½ */[72, "Hf", "é“ª", 6, 4, "d"], [73, "Ta", "é’½", 6, 5, "d"], [74, "W", "é’¨", 6, 6, "d"], [75, "Re", "é“¼", 6, 7, "d"], [76, "Os", "é”‡", 6, 8, "d"], [77, "Ir", "é“±", 6, 9, "d"], [78, "Pt", "é“‚", 6, 10, "d"], [79, "Au", "é‡‘", 6, 11, "ds"], [80, "Hg", "æ±", 6, 12, "ds"], [81, "Tl", "é“Š", 6, 13, "p"], [82, "Pb", "é“…", 6, 14, "p"], [83, "Bi", "é“‹", 6, 15, "p"], [84, "Po", "é’‹", 6, 16, "p", true], [85, "At", "ç ¹", 6, 17, "p"], [86, "Rn", "æ°¡", 6, 18, "p"],
            [87, "Fr", "é’«", 7, 1, "s"], [88, "Ra", "é•­", 7, 2, "s"],
        /* é”•ç³»å ä½ */[104, "Rf", "ğ¬¬­", 7, 4, "d"], [105, "Db", "ğ¬¬»", 7, 5, "d"], [106, "Sg", "ğ¬­³", 7, 6, "d"], [107, "Bh", "ğ¬­›", 7, 7, "d"], [108, "Hs", "ğ¬­¶", 7, 8, "d"], [109, "Mt", "é¿", 7, 9, "d"], [110, "Ds", "ğ«Ÿ¼", 7, 10, "d"], [111, "Rg", "éŒ€", 7, 11, "ds"], [112, "Cn", "é¿”", 7, 12, "ds"], [113, "Nh", "é¿­", 7, 13, "p"], [114, "Fl", "ğ«“§", 7, 14, "p"], [115, "Mc", "é•†", 7, 15, "p"], [116, "Lv", "ğ«Ÿ·", 7, 16, "p"], [117, "Ts", "é¿¬", 7, 17, "p"], [118, "Og", "é¿«", 7, 18, "p"]
        ];

        // é•§ç³» (fåŒº)
        const lanthanides = [
            [57, "La", "é•§"], [58, "Ce", "é“ˆ"], [59, "Pr", "é•¨"], [60, "Nd", "é’•"], [61, "Pm", "é’·"], [62, "Sm", "é’"], [63, "Eu", "é“•"], [64, "Gd", "é’†"], [65, "Tb", "é“½"], [66, "Dy", "é•"], [67, "Ho", "é’¬"], [68, "Er", "é“’"], [69, "Tm", "é“¥"], [70, "Yb", "é•±"], [71, "Lu", "é•¥"]
        ];
        // é”•ç³» (fåŒº)
        const actinides = [
            [89, "Ac", "é”•"], [90, "Th", "é’"], [91, "Pa", "é•¤"], [92, "U", "é“€"], [93, "Np", "é•"], [94, "Pu", "é’š"], [95, "Am", "é•…"], [96, "Cm", "é””"], [97, "Bk", "é”«"], [98, "Cf", "é”"], [99, "Es", "é”¿"], [100, "Fm", "é•„"], [101, "Md", "é’”"], [102, "No", "é”˜"], [103, "Lr", "é“¹"]
        ];

        const tableContainer = document.getElementById('table');
        const infoBar = document.getElementById('info-bar');

        function createElementBox(num, sym, hanzi, row, col, block, isStair) {
            const div = document.createElement('div');
            div.className = 'element';
            div.style.gridRow = row;
            div.style.gridColumn = col;

            div.setAttribute('data-block', block);
            div.setAttribute('data-group', col);
            div.setAttribute('data-atomic', num);
            if (isStair) div.setAttribute('data-stair', 'true');

            div.innerHTML = `
            <span class="atomic-number">${num}</span>
            <span class="symbol">${sym}</span>
            <span class="hanzi">${hanzi}</span>
        `;

            div.onclick = function () {
                handleElementClick({ num, sym, hanzi, row, col, block }, this);
            };

            div.oncontextmenu = function (e) {
                e.preventDefault();
                this.classList.toggle('is-marked');
                return false;
            };

            return div;
        }

        const electronConfigs = {
            1: "1s1",
            2: "1s2",
            3: "1s2 2s1",
            4: "1s2 2s2",
            5: "1s2 2s2 2p1",
            6: "1s2 2s2 2p2",
            7: "1s2 2s2 2p3",
            8: "1s2 2s2 2p4",
            9: "1s2 2s2 2p5",
            10: "1s2 2s2 2p6",
            11: "1s2 2s2 2p6 3s1",
            12: "1s2 2s2 2p6 3s2",
            13: "1s2 2s2 2p6 3s2 3p1",
            14: "1s2 2s2 2p6 3s2 3p2",
            15: "1s2 2s2 2p6 3s2 3p3",
            16: "1s2 2s2 2p6 3s2 3p4",
            17: "1s2 2s2 2p6 3s2 3p5",
            18: "1s2 2s2 2p6 3s2 3p6",
            19: "1s2 2s2 2p6 3s2 3p6 4s1",
            20: "1s2 2s2 2p6 3s2 3p6 4s2",
            21: "1s2 2s2 2p6 3s2 3p6 3d1 4s2",
            22: "1s2 2s2 2p6 3s2 3p6 3d2 4s2",
            23: "1s2 2s2 2p6 3s2 3p6 3d3 4s2",
            24: "1s2 2s2 2p6 3s2 3p6 3d5 4s1",
            25: "1s2 2s2 2p6 3s2 3p6 3d5 4s2",
            26: "1s2 2s2 2p6 3s2 3p6 3d6 4s2",
            27: "1s2 2s2 2p6 3s2 3p6 3d7 4s2",
            28: "1s2 2s2 2p6 3s2 3p6 3d8 4s2",
            29: "1s2 2s2 2p6 3s2 3p6 3d10 4s1",
            30: "1s2 2s2 2p6 3s2 3p6 3d10 4s2",
            31: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p1",
            32: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p2",
            33: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p3",
            34: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p4",
            35: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p5",
            36: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6",
            37: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 5s1",
            38: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 5s2",
            39: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d1 5s2",
            40: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d2 5s2",
            41: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d4 5s1",
            42: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d5 5s1",
            43: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d5 5s2",
            44: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d7 5s1",
            45: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d8 5s1",
            46: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10",
            47: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s1",
            48: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2",
            49: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p1",
            50: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p2",
            51: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p3",
            52: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p4",
            53: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p5",
            54: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p6",
            55: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p6 6s1",
            56: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p6 6s2",
            57: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p6 5d1 6s2",
            58: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f1 5s2 5p6 5d1 6s2",
            59: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f3 5s2 5p6 6s2",
            60: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f4 5s2 5p6 6s2",
            61: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f5 5s2 5p6 6s2",
            62: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f6 5s2 5p6 6s2",
            63: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f7 5s2 5p6 6s2",
            64: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f7 5s2 5p6 5d1 6s2",
            65: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f9 5s2 5p6 6s2",
            66: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f10 5s2 5p6 6s2",
            67: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f11 5s2 5p6 6s2",
            68: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f12 5s2 5p6 6s2",
            69: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f13 5s2 5p6 6s2",
            70: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 6s2",
            71: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d1 6s2",
            72: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d2 6s2",
            73: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d3 6s2",
            74: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d4 6s2",
            75: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d5 6s2",
            76: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d6 6s2",
            77: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d7 6s2",
            78: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d9 6s1",
            79: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s1",
            80: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2",
            81: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p1",
            82: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p2",
            83: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p3",
            84: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p4",
            85: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p5",
            86: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p6",
            87: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p6 7s1",
            88: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p6 7s2",
            89: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p6 6d1 7s2",
            90: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p6 6d2 7s2",
            91: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f2 6s2 6p6 6d1 7s2",
            92: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f3 6s2 6p6 6d1 7s2",
            93: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f4 6s2 6p6 6d1 7s2",
            94: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f6 6s2 6p6 7s2",
            95: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f7 6s2 6p6 7s2",
            96: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f7 6s2 6p6 6d1 7s2",
            97: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f9 6s2 6p6 7s2",
            98: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f10 6s2 6p6 7s2",
            99: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f11 6s2 6p6 7s2",
            100: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f12 6s2 6p6 7s2",
            101: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f13 6s2 6p6 7s2",
            102: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 7s2",
            103: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 7s2 7p1",
            104: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d2 7s2",
            105: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d3 7s2",
            106: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d4 7s2",
            107: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d5 7s2",
            108: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d6 7s2",
            109: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d7 7s2",
            110: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d8 7s2",
            111: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d9 7s2",
            112: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d10 7s2",
            113: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d10 7s2 7p1",
            114: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d10 7s2 7p2",
            115: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d10 7s2 7p3",
            116: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d10 7s2 7p4",
            117: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d10 7s2 7p5",
            118: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d10 7s2 7p6"
        };

        function formatConfig(config) {
            return config
                .split(' ')
                .map((token) => {
                    const match = token.match(/^(\d+)([spdfg])(\d+)$/);
                    if (!match) return token;
                    return `<span class="orbital">${match[1]}${match[2]}<sup>${match[3]}</sup></span>`;
                })
                .join(' ');
        }

        function electronConfig(num) {
            const raw = electronConfigs[num];
            return raw ? formatConfig(raw) : 'â€”';
        }

        function updateInfo({ num, sym, hanzi, row, col, block }) {
            let periodText = `${row}`;
            let groupText = `${col}`;
            let blockText = `${block}`;

            if (block === 'f') {
                periodText = row === 9 ? '6' : '7';
                groupText = row === 9 ? 'é•§ç³»' : 'é”•ç³»';
                blockText = 'f';
            }

            const config = electronConfig(num);
            infoBar.innerHTML = `
                <div>
                    <span class="label">å…ƒç´ ï¼š</span>${sym}ï¼ˆ${hanzi}ï¼Œ${num}å·ï¼‰
                    <span class="label" style="margin-left:10px;">å‘¨æœŸï¼š</span>${periodText}
                    <span class="label" style="margin-left:10px;">æ—ï¼š</span>${groupText}
                    <span class="label" style="margin-left:10px;">åˆ†åŒºï¼š</span>${blockText}
                </div>
                <div class="config"><span class="label">ç”µå­æ’å¸ƒï¼š</span>${config}</div>
            `;
        }

        function setSelected(el) {
            const prev = document.querySelector('.element.is-selected');
            if (prev) prev.classList.remove('is-selected');
            el.classList.add('is-selected');
        }

        const defaultInfoHtml = `
            <div><span class="label">å…ƒç´ è¯¦æƒ…ï¼š</span>ç‚¹å‡»ä»»ä¸€å…ƒç´ æŸ¥çœ‹ç”µå­æ’å¸ƒã€æ—åºæ•°å’Œå‘¨æœŸåºæ•°</div>
            <div class="info-note">ç”µå­æ’å¸ƒä½¿ç”¨å…¨å…ƒç´ æ•°æ®è¡¨ï¼Œé€‚åˆè¯¾å ‚å±•ç¤º</div>
        `;

        function renderDefaultInfo() {
            infoBar.innerHTML = defaultInfoHtml;
        }

        const quizElements = [
            ...elementsData.map(([num, sym, hanzi, row, col, block]) => ({ num, sym, hanzi, row, col, block })),
            ...lanthanides.map(([num, sym, hanzi]) => ({ num, sym, hanzi, row: 9, col: null, block: "f" })),
            ...actinides.map(([num, sym, hanzi]) => ({ num, sym, hanzi, row: 10, col: null, block: "f" }))
        ];

        const commonQuizElements = quizElements.filter(el => el.num <= 103);

        const quizModeMap = {
            random_all: { mode: "random", pool: "all", label: "éšæœºï¼ˆå…¨å…ƒç´ ï¼‰" },
            symbol_all: { mode: "symbol", pool: "all", label: "åªé—®ç¬¦å·ï¼ˆå…¨å…ƒç´ ï¼‰" },
            hanzi_all: { mode: "hanzi", pool: "all", label: "åªé—®æ±‰å­—ï¼ˆå…¨å…ƒç´ ï¼‰" },
            common_random: { mode: "random", pool: "common", label: "å¸¸ç”¨å…ƒç´ ï¼ˆéšæœºï¼‰" }
        };

        const quizState = {
            active: false,
            correct: 0,
            total: 0,
            modeSetting: "random",
            promptMode: "symbol",
            pool: "all",
            target: null,
            lastResult: null,
            modeLabel: "éšæœºï¼ˆå…¨å…ƒç´ ï¼‰"
        };

        function getQuizPool() {
            return quizState.pool === "common" ? commonQuizElements : quizElements;
        }

        function applyQuizMode(value) {
            const config = quizModeMap[value] || quizModeMap.random_all;
            quizState.modeSetting = config.mode;
            quizState.pool = config.pool;
            quizState.modeLabel = config.label;
        }

        function setQuizMode(value) {
            applyQuizMode(value);
            if (quizState.active) {
                quizState.correct = 0;
                quizState.total = 0;
                quizState.lastResult = null;
                nextQuizTarget();
                resetTable(true);
                renderQuizPrompt();
            } else {
                renderDefaultInfo();
            }
        }

        function nextQuizTarget() {
            const pool = getQuizPool();
            const pick = pool[Math.floor(Math.random() * pool.length)];
            quizState.target = pick;
            quizState.promptMode = quizState.modeSetting === "random"
                ? (Math.random() < 0.5 ? "symbol" : "hanzi")
                : quizState.modeSetting;
        }

        function renderQuizPrompt() {
            if (!quizState.active || !quizState.target) {
                renderDefaultInfo();
                return;
            }

            const promptLabel = quizState.promptMode === "symbol" ? "ç¬¦å·" : "æ±‰å­—";
            const promptValue = quizState.promptMode === "symbol" ? quizState.target.sym : quizState.target.hanzi;
            const result = quizState.lastResult
                ? `<div class="quiz-result ${quizState.lastResult.correct ? "is-correct" : "is-wrong"}">${quizState.lastResult.text}</div>`
                : "";

            infoBar.innerHTML = `
                <div>
                    <span class="label">å­¦ä¹ æ¨¡å¼ï¼š</span>è¯·ç‚¹å‡»å…ƒç´ ${promptLabel}ä¸º
                    <span class="quiz-target">${promptValue}</span>
                </div>
                <div class="quiz-score">é¢˜å‹ï¼š${quizState.modeLabel} ï½œ è¿›åº¦ï¼š${quizState.correct}/${quizState.total} ${result}</div>
            `;
        }

        function handleElementClick(data, element) {
            if (!quizState.active) {
                element.classList.toggle('is-revealed');
                setSelected(element);
                updateInfo(data);
                return;
            }

            quizState.total += 1;
            const isCorrect = data.num === quizState.target.num;
            quizState.lastResult = {
                correct: isCorrect,
                text: isCorrect ? "å›ç­”æ­£ç¡®" : `æ­£ç¡®ç­”æ¡ˆï¼š${quizState.target.sym}ï¼ˆ${quizState.target.hanzi}ï¼‰`
            };

            if (isCorrect) {
                element.classList.add('is-revealed');
                setSelected(element);
                quizState.correct += 1;
            }

            nextQuizTarget();
            renderQuizPrompt();
        }

        function toggleQuiz() {
            quizState.active = !quizState.active;
            const btn = document.getElementById("btn-quiz");
            const modeSelect = document.getElementById("quiz-mode");

            if (quizState.active) {
                applyQuizMode(modeSelect ? modeSelect.value : "random_all");
                quizState.correct = 0;
                quizState.total = 0;
                quizState.lastResult = null;
                nextQuizTarget();
                resetTable(true);
                btn.textContent = "ğŸ§ª ç»“æŸå­¦ä¹ ";
                btn.classList.add("active");
                renderQuizPrompt();
            } else {
                btn.textContent = "ğŸ§ª å¼€å§‹å­¦ä¹ ";
                btn.classList.remove("active");
                quizState.lastResult = null;
                quizState.target = null;
                renderDefaultInfo();
            }
        }

        function initTable() {
            tableContainer.innerHTML = '';

            // ä¸»æ—
            elementsData.forEach(el => {
                tableContainer.appendChild(createElementBox(el[0], el[1], el[2], el[3], el[4], el[5], el[6]));
            });

            // æ ‡ç­¾
            const labelLa = document.createElement('div');
            labelLa.className = 'series-label';
            labelLa.style.gridRow = '9'; labelLa.style.gridColumn = '1 / span 3';
            labelLa.textContent = 'é•§ç³» (57-71)';
            tableContainer.appendChild(labelLa);

            const labelAc = document.createElement('div');
            labelAc.className = 'series-label';
            labelAc.style.gridRow = '10'; labelAc.style.gridColumn = '1 / span 3';
            labelAc.textContent = 'é”•ç³» (89-103)';
            tableContainer.appendChild(labelAc);

            // é•§ç³»
            lanthanides.forEach((el, index) => {
                tableContainer.appendChild(createElementBox(el[0], el[1], el[2], 9, index + 4, "f", false));
            });
            // é”•ç³»
            actinides.forEach((el, index) => {
                tableContainer.appendChild(createElementBox(el[0], el[1], el[2], 10, index + 4, "f", false));
            });

            renderDefaultInfo();
        }

        // æ§åˆ¶é€»è¾‘
        const container = document.querySelector('.periodic-table-container');

        function toggleGlobal(mode) {
            const btnMap = {
                'number': 'btn-num',
                'symbol': 'btn-sym',
                'hanzi': 'btn-hanzi',
                'zones': 'btn-zones',
                'staircase': 'btn-stair'
            };

            const className = `show-${mode}`;
            container.classList.toggle(className);

            const btn = document.getElementById(btnMap[mode]);
            if (container.classList.contains(className)) {
                btn.classList.add('active');
            } else {
                btn.classList.remove('active');
            }
        }

        function resetTable(quiet) {
            // æ¸…é™¤æ‰€æœ‰å…¨å±€çŠ¶æ€ç±»
            const classes = ['show-number', 'show-symbol', 'show-hanzi', 'show-zones', 'show-staircase'];
            classes.forEach(c => container.classList.remove(c));

            // é‡ç½®æŒ‰é’®çŠ¶æ€
            document.querySelectorAll('.controls button').forEach(btn => btn.classList.remove('active'));
            if (quizState.active) {
                const quizBtn = document.getElementById("btn-quiz");
                if (quizBtn) quizBtn.classList.add("active");
            }

            // é‡ç½®æ ¼å­ä¸ªåˆ«çŠ¶æ€
            const allElements = document.querySelectorAll('.element');
            allElements.forEach(el => {
                el.classList.remove('is-revealed');
                el.classList.remove('is-marked');
                el.classList.remove('is-selected');
            });

            if (!quiet) {
                if (quizState.active) {
                    renderQuizPrompt();
                } else {
                    renderDefaultInfo();
                }
            }
        }

        initTable();
    </script>

</body>

</html>

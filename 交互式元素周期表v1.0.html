<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äº¤äº’å¼å…ƒç´ å‘¨æœŸè¡¨v1.0</title>
    <!-- å¼•å…¥åœ†æ¶¦å¯çˆ±çš„å­—ä½“ Quicksand ç”¨äºæ•°å­—å’Œè‹±æ–‡ï¼Œæ€æºé»‘ä½“ç”¨äºä¸­æ–‡ -->
    <link href="https://fonts.googleapis.com/css2?family=Quicksand:wght@500;700&family=Noto+Sans+SC:wght@400;700&display=swap" rel="stylesheet">
    <style>
        :root {
            /* --- é…è‰²ç³»ç»Ÿ (é©¬å¡é¾™/ç³–æœè‰²) --- */
            --bg-body: #f0f4f8;
            --card-bg: #ffffff;
            
            /* é˜´å½±ç³»ç»Ÿ */
            --shadow-sm: 0 2px 4px rgba(148, 163, 184, 0.15);
            --shadow-md: 0 4px 6px -1px rgba(148, 163, 184, 0.2), 0 2px 4px -1px rgba(148, 163, 184, 0.1);
            --shadow-hover: 0 10px 15px -3px rgba(148, 163, 184, 0.25), 0 4px 6px -2px rgba(148, 163, 184, 0.1);
            --shadow-float: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);

            /* çŠ¶æ€è‰² */
            --reveal-bg: #d1fae5;
            --mark-bg: #fee2e2;
            --active-color: #3b82f6;
            
            /* åˆ†åŒºé¢œè‰² */
            --s-block: #ffedd5;      /* æ©™è‰² */
            --p-block: #e0f2fe;      /* è“è‰² */
            --d-block: #fef3c7;      /* é»„è‰² */
            --f-block: #fce7f3;      /* ç²‰è‰² */
            --ds-block: #bbf7d0;     /* è–„è·ç»¿ */
            --noble-block: #ddd6fe;  /* ç´«è‰² */

            /* å°ºå¯¸ç³»ç»Ÿ */
            --box-size: 72px;
            --gap-size: 6px;
            --radius-box: 12px;
            --radius-btn: 99px;
            --radius-card: 32px; /* ç»Ÿä¸€å¡ç‰‡åœ†è§’ */
            
            /* å­—ä½“æ’ç‰ˆ */
            --font-main: 'Quicksand', 'Noto Sans SC', system-ui, sans-serif;
            --font-symbol: 26px;
            --font-hanzi: 13px;
            --font-atomic: 11px;
            --font-mass: 9px;
            --text-primary: #1e293b;
            --text-secondary: #94a3b8;
        }

        /* å“åº”å¼è°ƒæ•´ */
        @media (max-width: 1600px) {
            :root {
                --box-size: 58px;
                --gap-size: 4px;
                --font-symbol: 20px;
                --font-hanzi: 11px;
                --font-atomic: 10px;
                --font-mass: 8px;
            }
        }
        @media (max-width: 1200px) {
            :root {
                --box-size: 44px;
                --gap-size: 3px;
                --font-symbol: 16px;
                --font-hanzi: 10px;
                --font-atomic: 9px;
                --font-mass: 7px;
            }
            .side-column { display: none; }
        }

        /* å¸ƒå±€è®¡ç®— */
        :root {
            --period-label-width: 30px;
            --side-col-width: var(--box-size);
            --side-cols-width: calc(2 * var(--side-col-width) + var(--gap-size));
            --table-width: calc(18 * var(--box-size) + 17 * var(--gap-size));
            --container-width: calc(var(--table-width) + var(--period-label-width) + var(--side-cols-width) + 60px);
            --label-height: 24px;
        }
        @media (max-width: 1200px) {
             :root { --container-width: calc(var(--table-width) + var(--period-label-width) + 40px); }
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-body);
            margin: 0;
            padding: 24px;
            color: var(--text-primary);
            display: flex;
            flex-direction: column;
            align-items: center;
            /* å…è®¸é¡µé¢çºµå‘æ»šåŠ¨ï¼Œé˜²æ­¢æ¨ªå‘æº¢å‡º */
            overflow-x: hidden; 
        }

        /* --- é¡¶æ  & æ§åˆ¶å° --- */
        .top-row {
            display: flex;
            gap: 16px;
            width: var(--container-width);
            max-width: 100%;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
            align-items: flex-start;
        }

        .controls {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(10px);
            padding: 12px 20px;
            border-radius: 24px;
            box-shadow: var(--shadow-float);
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            justify-content: center;
            border: 1px solid rgba(255,255,255,0.5);
            flex: 1;
            min-width: 320px;
        }

        .control-group {
            display: flex;
            gap: 8px;
            padding: 0 12px;
            border-right: 2px dashed #e2e8f0;
            align-items: center;
        }
        .control-group:last-child { border-right: none; }

        .control-label {
            font-size: 13px;
            color: var(--text-secondary);
            font-weight: 700;
            margin-right: 4px;
            letter-spacing: 0.5px;
            text-transform: uppercase;
        }

        button, select {
            padding: 6px 14px;
            cursor: pointer;
            background-color: #fff;
            color: #64748b;
            border: 2px solid #e2e8f0;
            border-radius: var(--radius-btn);
            font-size: 13px;
            font-family: var(--font-main);
            font-weight: 700;
            transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);
            display: flex;
            align-items: center;
            gap: 6px;
        }

        button:hover, select:hover {
            border-color: #cbd5e1;
            transform: translateY(-2px);
            box-shadow: 0 4px 6px rgba(0,0,0,0.05);
            color: #334155;
        }
        button:active { transform: translateY(0); }
        button.active {
            background-color: #eff6ff;
            border-color: #3b82f6;
            color: #2563eb;
            box-shadow: 0 0 0 1px #3b82f6 inset;
        }
        button[onclick="resetTable()"] { border-color: #fecaca; color: #ef4444; }
        button[onclick="resetTable()"]:hover { background-color: #fef2f2; border-color: #ef4444; }

        /* --- å›¾ä¾‹æ¿ --- */
        .legend-panel { display: flex; justify-content: center; }
        .legend-box {
            background: #fff;
            border-radius: 20px;
            padding: 12px 16px;
            box-shadow: var(--shadow-sm);
            border: 1px solid #f1f5f9;
        }
        .legend-title { font-size: 12px; font-weight: 700; color: #64748b; margin-bottom: 8px; text-align: center; }
        .legend { display: flex; flex-wrap: wrap; gap: 8px 12px; justify-content: center; }
        .legend span { display: inline-flex; align-items: center; gap: 6px; font-size: 11px; font-weight: 600; color: #475569; }
        .dot { width: 10px; height: 10px; border-radius: 4px; display: inline-block; }

        /* --- æç¤ºæ  & ä¿¡æ¯æ  --- */
        .status-bar {
            width: var(--container-width);
            max-width: 100%;
            display: flex; justify-content: space-between;
            margin-bottom: 12px;
            font-size: 13px; color: #64748b; font-weight: 500;
        }
        .context-hint { background: #e2e8f0; padding: 2px 8px; border-radius: 6px; color: #475569; font-size: 11px; }

        .info-bar {
            width: var(--container-width);
            max-width: 100%;
            background: #fff;
            border-radius: 16px;
            padding: 16px 24px;
            box-shadow: var(--shadow-md);
            margin-bottom: 24px;
            display: flex;
            flex-wrap: wrap;
            align-items: center;
            justify-content: space-between;
            gap: 16px;
            border: 1px solid #f1f5f9;
            transition: all 0.3s;
            box-sizing: border-box; /* é˜²æ­¢paddingæ’‘å¤§ */
        }
        .info-bar .label { color: #64748b; font-weight: 600; font-size: 14px; margin-right: 4px; }
        .info-bar .value { color: #0f172a; font-weight: 700; font-size: 16px; margin-right: 16px; }
        .info-bar .config { font-family: 'Roboto Mono', monospace; background: #f1f5f9; padding: 4px 8px; border-radius: 6px; color: #334155; }
        .info-bar .mass-highlight { color: #d97706; background: #fffbeb; padding: 2px 6px; border-radius: 4px; border: 1px solid #fcd34d; font-size: 0.9em; }

        .quiz-target { font-size: 1.4em; color: #2563eb; font-weight: 800; background: #eff6ff; padding: 0 8px; border-radius: 8px; }
        .quiz-result { padding: 4px 10px; border-radius: 20px; font-size: 12px; margin-left: 10px; }
        .quiz-result.is-correct { background: #dcfce7; color: #15803d; }
        .quiz-result.is-wrong { background: #fee2e2; color: #b91c1c; }

        /* --- å‘¨æœŸè¡¨å¡ç‰‡ (ç‹¬ç«‹) --- */
        .periodic-table-container {
            position: relative;
            background: #fff;
            padding: 30px;
            border-radius: var(--radius-card);
            box-shadow: var(--shadow-float);
            /* å…³é”®å¸ƒå±€å±æ€§ */
            width: fit-content; /* å°½å¯èƒ½å®½ */
            max-width: 100%; /* ä½†ä¸è¶…è¿‡çˆ¶å®¹å™¨ */
            overflow-x: auto; /* åªæœ‰è¿™é‡Œæ¨ªå‘æ»šåŠ¨ */
            margin-bottom: 24px;
        }

        .table-grid {
            display: grid;
            grid-template-columns: var(--period-label-width) var(--table-width) var(--side-cols-width);
            column-gap: 8px;
        }

        .periodic-table {
            display: grid;
            grid-template-columns: repeat(18, var(--box-size));
            grid-template-rows: repeat(10, var(--box-size));
            gap: var(--gap-size);
            margin-bottom: 20px;
            margin-top: calc(var(--label-height) + var(--gap-size));
        }

        .table-stack {
            position: relative;
            width: var(--table-width);
            height: calc(10 * var(--box-size) + 9 * var(--gap-size) + var(--label-height) + var(--gap-size));
        }

        /* æ ‡ç­¾ */
        .group-label, .period-label, .side-header, .side-cell {
            position: absolute;
            display: flex; align-items: center; justify-content: center;
            color: #94a3b8; font-size: 12px; font-weight: 700;
            background: transparent; border: none;
        }
        
        .period-labels { display: grid; grid-template-rows: repeat(7, var(--box-size)); gap: var(--gap-size); margin-top: calc(var(--label-height) + var(--gap-size)); }
        .period-label { position: relative; height: var(--box-size); width: 100%; }
        
        .group-label {
            width: var(--box-size); height: var(--label-height); flex-direction: column;
            left: calc((var(--col) - 1) * (var(--box-size) + var(--gap-size)));
            top: calc((var(--row) - 1) * (var(--box-size) + var(--gap-size)));
        }
        .group-num { color: #64748b; }
        .group-old { font-size: 9px; opacity: 0.6; }

        /* ä¾§è¾¹æ  */
        .side-headers {
            display: grid; grid-template-columns: repeat(2, var(--side-col-width)); gap: var(--gap-size);
            position: absolute; top: 0; left: 0;
        }
        .side-header {
            position: relative; width: 100%; text-align: center;
            font-size: 11px; color: #64748b; font-weight: 700;
            white-space: nowrap;
        }
        .side-labels {
            display: grid; grid-template-columns: repeat(2, var(--side-col-width)); gap: var(--gap-size);
            grid-auto-rows: var(--box-size);
            margin-top: calc(var(--label-height) + var(--gap-size));
        }
        .side-cell {
            position: relative; width: 100%; height: var(--box-size);
            background: #f8fafc; border-radius: 8px; color: #64748b;
        }
        .side-cell.multiline {
            font-size: 9px;
            line-height: 1.15;
            flex-direction: column;
            text-align: center;
            white-space: normal;
        }
        .side-column { position: relative; width: var(--side-cols-width); height: 100%; }

        /* --- å…ƒç´ å¡ç‰‡ --- */
        .element {
            background: #fff;
            border-radius: var(--radius-box);
            box-shadow: var(--shadow-sm);
            border: 2px solid transparent;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            position: relative; box-sizing: border-box; height: 100%; width: 100%;
            cursor: pointer; transition: all 0.2s cubic-bezier(0.34, 1.56, 0.64, 1);
            overflow: hidden;
        }
        .element:hover { z-index: 10; transform: scale(1.15) translateY(-4px); box-shadow: var(--shadow-hover); }
        .element.is-revealed { background-color: #f1f5f9; border-color: rgba(0,0,0,0.05); }
        .element.is-selected { border-color: var(--active-color); box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.3); z-index: 20; }
        .element.is-marked { background-color: var(--mark-bg); }
        .element.is-marked::after { content: "â€¢"; position: absolute; top: 2px; right: 45%; color: #ef4444; font-size: 20px; line-height: 0; }
        
        /* é¢œè‰²é€»è¾‘ */
        .show-zones .element[data-block="s"] { background-color: var(--s-block); }
        .show-zones .element[data-block="p"] { background-color: var(--p-block); }
        .show-zones .element[data-block="d"] { background-color: var(--d-block); }
        .show-zones .element[data-block="ds"] { background-color: var(--ds-block); }
        .show-zones .element[data-block="f"] { background-color: var(--f-block); }
        .show-zones .element[data-group="18"]:not([data-block="f"]) { background-color: var(--noble-block); }
        
        .show-staircase .element[data-stair="true"] { box-shadow: 3px 3px 0 #fca5a5; border-bottom-right-radius: 4px; }

        .atomic-number { position: absolute; top: 4px; left: 5px; font-size: var(--font-atomic); font-weight: 700; color: var(--text-secondary); opacity: 0; transition: opacity 0.2s; }
        .atomic-mass { position: absolute; top: 4px; right: 5px; font-size: var(--font-mass); font-family: 'Roboto Mono', monospace; color: var(--text-secondary); opacity: 0; transition: opacity 0.2s; }
        .symbol { font-size: var(--font-symbol); font-weight: 800; color: var(--text-primary); margin-top: 4px; margin-bottom: 0px; letter-spacing: -0.5px; opacity: 0; transition: opacity 0.2s; text-shadow: 0 1px 0 rgba(255,255,255,0.5); }
        .hanzi { font-size: var(--font-hanzi); font-weight: 500; color: #475569; opacity: 0; transition: opacity 0.2s; }

        .show-number .atomic-number, .show-mass .atomic-mass, .show-symbol .symbol, .show-hanzi .hanzi { opacity: 1; }
        .element.is-revealed .atomic-number, .element.is-revealed .atomic-mass, .element.is-revealed .symbol, .element.is-revealed .hanzi { opacity: 1 !important; }

        /* --- ä»»åŠ¡åŒºå¡ç‰‡ (æ–°ç‹¬ç«‹ç»„ä»¶) --- */
        .notes-card {
            background: #fff;
            padding: 30px;
            border-radius: var(--radius-card);
            box-shadow: var(--shadow-float);
            /* å…³é”®é€»è¾‘ï¼šå°½åŠ›å˜å®½ï¼Œä½†ä¸è¶…è¿‡å±å¹• */
            width: var(--container-width);
            max-width: 100%; 
            box-sizing: border-box; /* å†…å‡æ¨¡å¼ï¼Œpadding ä¸ä¼šæ’‘å¤§å®½åº¦ */
        }

        .teaching-notes {
            width: 100%;
            border: 2px dashed #cbd5e1; 
            padding: 24px; 
            border-radius: 20px;
            background: #f8fafc; color: #475569; font-size: 14px; line-height: 1.6;
            outline: none; transition: all 0.2s;
            box-sizing: border-box; /* ç¡®ä¿ padding åœ¨å†… */
            /* å…è®¸é«˜åº¦è‡ªåŠ¨ç”Ÿé•¿ï¼Œæ— éœ€æ»šåŠ¨æ¡ */
            min-height: 100px;
            height: auto;
            white-space: pre-wrap; /* å…è®¸æ¢è¡Œ */
            word-wrap: break-word; /* å¼ºåˆ¶é•¿è¯æ¢è¡Œ */
        }
        .teaching-notes:focus { border-color: #3b82f6; background: #fff; box-shadow: var(--shadow-sm); }
        .series-label { display: flex; align-items: center; justify-content: flex-end; padding-right: 12px; font-size: 11px; color: #94a3b8; font-weight: 700; text-transform: uppercase; letter-spacing: 1px; }

    </style>
</head>

<body>

    <div class="top-row">
        <div class="controls">
            <div class="control-group">
                <span class="control-label">æ˜¾ç¤º</span>
                <button id="btn-num" onclick="toggleGlobal('number')">ğŸ”¢ åºå·</button>
                <button id="btn-zones" onclick="toggleGlobal('zones')">ğŸ¨ åˆ†åŒº</button>
                <button id="btn-stair" onclick="toggleGlobal('staircase')">ğŸ“‰ åˆ†ç•Œ</button>
                <button id="btn-mass" onclick="toggleGlobal('mass')">âš–ï¸ è´¨é‡</button>
            </div>

            <div class="control-group">
                <span class="control-label">ç­”æ¡ˆ</span>
                <button id="btn-sym" onclick="toggleGlobal('symbol')">ğŸ”  ç¬¦å·</button>
                <button id="btn-hanzi" onclick="toggleGlobal('hanzi')">ğŸ‡¨ğŸ‡³ æ±‰å­—</button>
            </div>

            <div class="control-group">
                <span class="control-label">æ¨¡å¼</span>
                <button id="btn-quiz" onclick="toggleQuiz()">ğŸ§ª æµ‹éªŒ</button>
                <select id="quiz-mode" onchange="setQuizMode(this.value)">
                    <option value="random_all">éšæœº (å…¨è¡¨)</option>
                    <option value="symbol_all">ç¬¦å· (å…¨è¡¨)</option>
                    <option value="hanzi_all">æ±‰å­— (å…¨è¡¨)</option>
                    <option value="common_random">éšæœº (å¸¸ç”¨)</option>
                </select>
            </div>

            <div class="control-group">
                <button onclick="resetTable()">ğŸ—‘ï¸ é‡ç½®</button>
            </div>
        </div>
        
        <div class="legend-panel">
            <div class="legend-box">
                <div class="legend-title">BLOCKS</div>
                <div class="legend">
                    <span><i class="dot" style="background:var(--s-block)"></i>s</span>
                    <span><i class="dot" style="background:var(--p-block)"></i>p</span>
                    <span><i class="dot" style="background:var(--d-block)"></i>d</span>
                    <span><i class="dot" style="background:var(--ds-block)"></i>ds</span>
                    <span><i class="dot" style="background:var(--f-block)"></i>f</span>
                    <span><i class="dot" style="background:var(--noble-block)"></i>ç¨€æœ‰</span>
                </div>
            </div>
        </div>
    </div>

    <div class="status-bar">
        <div class="instructions">
            <span>ğŸ–±ï¸ å·¦é”®ï¼šæ­æ™“</span>
            <span class="context-hint">ğŸ–±ï¸ å³é”®ï¼šæ ‡è®°</span>
        </div>
        <div style="font-size: 11px; opacity: 0.5;">v1.0 Responsive Notes</div>
    </div>

    <div class="info-bar" id="info-bar">
        <!-- JS å¡«å…… -->
    </div>

    <!-- 1. å‘¨æœŸè¡¨ç‹¬ç«‹å¡ç‰‡ -->
    <div class="periodic-table-container">
        <div class="table-grid">
            <div class="period-labels">
                <div class="period-label">1</div>
                <div class="period-label">2</div>
                <div class="period-label">3</div>
                <div class="period-label">4</div>
                <div class="period-label">5</div>
                <div class="period-label">6</div>
                <div class="period-label">7</div>
            </div>

            <div class="table-stack">
                <div class="group-labels">
                    <!-- JS ç”Ÿæˆ -->
                </div>

                <div class="periodic-table" id="table"></div>
            </div>

            <div class="side-column">
                <div class="side-headers">
                    <div class="side-header">ç”µå­å±‚</div>
                    <div class="side-header">0æ—ç”µå­æ•°</div>
                </div>
                <div class="side-labels">
                    <div class="side-cell multiline">K</div>
                    <div class="side-cell multiline">2</div>
                    <div class="side-cell multiline">K<br>L</div>
                    <div class="side-cell multiline">2<br>8</div>
                    <div class="side-cell multiline">K<br>L<br>M</div>
                    <div class="side-cell multiline">2<br>8<br>8</div>
                    <div class="side-cell multiline">K<br>L<br>M<br>N</div>
                    <div class="side-cell multiline">2<br>8<br>18<br>8</div>
                    <div class="side-cell multiline">K<br>L<br>M<br>N<br>O</div>
                    <div class="side-cell multiline">2<br>8<br>18<br>18<br>8</div>
                    <div class="side-cell multiline">K<br>L<br>M<br>N<br>O<br>P</div>
                    <div class="side-cell multiline">2<br>8<br>18<br>32<br>18<br>8</div>
                    <div class="side-cell multiline">K<br>L<br>M<br>N<br>O<br>P<br>Q</div>
                    <div class="side-cell multiline">2<br>8<br>18<br>32<br>32<br>18<br>8</div>
                </div>
            </div>
        </div>
    </div> <!-- å‘¨æœŸè¡¨å¡ç‰‡ç»“æŸ -->

    <!-- 2. ä»»åŠ¡åŒºç‹¬ç«‹å¡ç‰‡ (è‡ªé€‚åº”å®½åº¦) -->
    <div class="notes-card">
        <div class="teaching-notes" contenteditable="true">
            <div style="font-weight:700; color:#3b82f6; margin-bottom:8px;" contenteditable="false">ğŸ“ è¯¾å ‚ä»»åŠ¡åŒº</div>
            1. å¼€å¯â€œæ±‰å­—â€å¼€å…³ï¼Œé»˜å†™åŒ–å­¦ç¬¦å·ã€‚<br>
            2. ç‚¹å‡»â€œè´¨é‡â€æŒ‰é’®ï¼ŒæŸ¥çœ‹å…ƒç´ çš„ç›¸å¯¹åŸå­è´¨é‡ã€‚<br>
            3. å°è¯•åœ¨æµ‹éªŒæ¨¡å¼ä¸‹è¾¾åˆ° 100% æ­£ç¡®ç‡ï¼<br>
            <span style="color:#94a3b8; font-size:12px;">(ç‚¹å‡»æ­¤å¤„å¯ç›´æ¥è¾“å…¥æ›´å¤šç¬”è®°...)</span>
        </div>
    </div>

    <script>
        const elementsData = [
            [1, "H", "æ°¢", 1, 1, "s"], [2, "He", "æ°¦", 1, 18, "p"],
            [3, "Li", "é”‚", 2, 1, "s"], [4, "Be", "é“", 2, 2, "s"], [5, "B", "ç¡¼", 2, 13, "p", true], [6, "C", "ç¢³", 2, 14, "p"], [7, "N", "æ°®", 2, 15, "p"], [8, "O", "æ°§", 2, 16, "p"], [9, "F", "æ°Ÿ", 2, 17, "p"], [10, "Ne", "æ°–", 2, 18, "p"],
            [11, "Na", "é’ ", 3, 1, "s"], [12, "Mg", "é•", 3, 2, "s"], [13, "Al", "é“", 3, 13, "p", true], [14, "Si", "ç¡…", 3, 14, "p", true], [15, "P", "ç£·", 3, 15, "p"], [16, "S", "ç¡«", 3, 16, "p"], [17, "Cl", "æ°¯", 3, 17, "p"], [18, "Ar", "æ°©", 3, 18, "p"],
            [19, "K", "é’¾", 4, 1, "s"], [20, "Ca", "é’™", 4, 2, "s"], [21, "Sc", "é’ª", 4, 3, "d"], [22, "Ti", "é’›", 4, 4, "d"], [23, "V", "é’’", 4, 5, "d"], [24, "Cr", "é“¬", 4, 6, "d"], [25, "Mn", "é”°", 4, 7, "d"], [26, "Fe", "é“", 4, 8, "d"], [27, "Co", "é’´", 4, 9, "d"], [28, "Ni", "é•", 4, 10, "d"], [29, "Cu", "é“œ", 4, 11, "ds"], [30, "Zn", "é”Œ", 4, 12, "ds"], [31, "Ga", "é•“", 4, 13, "p"], [32, "Ge", "é”—", 4, 14, "p", true], [33, "As", "ç ·", 4, 15, "p", true], [34, "Se", "ç¡’", 4, 16, "p"], [35, "Br", "æº´", 4, 17, "p"], [36, "Kr", "æ°ª", 4, 18, "p"],
            [37, "Rb", "é“·", 5, 1, "s"], [38, "Sr", "é”¶", 5, 2, "s"], [39, "Y", "é’‡", 5, 3, "d"], [40, "Zr", "é”†", 5, 4, "d"], [41, "Nb", "é“Œ", 5, 5, "d"], [42, "Mo", "é’¼", 5, 6, "d"], [43, "Tc", "é”", 5, 7, "d"], [44, "Ru", "é’Œ", 5, 8, "d"], [45, "Rh", "é“‘", 5, 9, "d"], [46, "Pd", "é’¯", 5, 10, "d"], [47, "Ag", "é“¶", 5, 11, "ds"], [48, "Cd", "é•‰", 5, 12, "ds"], [49, "In", "é“Ÿ", 5, 13, "p"], [50, "Sn", "é”¡", 5, 14, "p"], [51, "Sb", "é”‘", 5, 15, "p", true], [52, "Te", "ç¢²", 5, 16, "p", true], [53, "I", "ç¢˜", 5, 17, "p"], [54, "Xe", "æ°™", 5, 18, "p"],
            [55, "Cs", "é“¯", 6, 1, "s"], [56, "Ba", "é’¡", 6, 2, "s"],
            [72, "Hf", "é“ª", 6, 4, "d"], [73, "Ta", "é’½", 6, 5, "d"], [74, "W", "é’¨", 6, 6, "d"], [75, "Re", "é“¼", 6, 7, "d"], [76, "Os", "é”‡", 6, 8, "d"], [77, "Ir", "é“±", 6, 9, "d"], [78, "Pt", "é“‚", 6, 10, "d"], [79, "Au", "é‡‘", 6, 11, "ds"], [80, "Hg", "æ±", 6, 12, "ds"], [81, "Tl", "é“Š", 6, 13, "p"], [82, "Pb", "é“…", 6, 14, "p"], [83, "Bi", "é“‹", 6, 15, "p"], [84, "Po", "é’‹", 6, 16, "p", true], [85, "At", "ç ¹", 6, 17, "p"], [86, "Rn", "æ°¡", 6, 18, "p"],
            [87, "Fr", "é’«", 7, 1, "s"], [88, "Ra", "é•­", 7, 2, "s"],
            [104, "Rf", "ğ¬¬­", 7, 4, "d"], [105, "Db", "ğ¬¬»", 7, 5, "d"], [106, "Sg", "ğ¬­³", 7, 6, "d"], [107, "Bh", "ğ¬­›", 7, 7, "d"], [108, "Hs", "ğ¬­¶", 7, 8, "d"], [109, "Mt", "é¿", 7, 9, "d"], [110, "Ds", "ğ«Ÿ¼", 7, 10, "d"], [111, "Rg", "éŒ€", 7, 11, "ds"], [112, "Cn", "é¿”", 7, 12, "ds"], [113, "Nh", "é¿­", 7, 13, "p"], [114, "Fl", "ğ«“§", 7, 14, "p"], [115, "Mc", "é•†", 7, 15, "p"], [116, "Lv", "ğ«Ÿ·", 7, 16, "p"], [117, "Ts", "é¿¬", 7, 17, "p"], [118, "Og", "é¿«", 7, 18, "p"]
        ];

        const lanthanides = [
            [57, "La", "é•§"], [58, "Ce", "é“ˆ"], [59, "Pr", "é•¨"], [60, "Nd", "é’•"], [61, "Pm", "é’·"], [62, "Sm", "é’"], [63, "Eu", "é“•"], [64, "Gd", "é’†"], [65, "Tb", "é“½"], [66, "Dy", "é•"], [67, "Ho", "é’¬"], [68, "Er", "é“’"], [69, "Tm", "é“¥"], [70, "Yb", "é•±"], [71, "Lu", "é•¥"]
        ];
        const actinides = [
            [89, "Ac", "é”•"], [90, "Th", "é’"], [91, "Pa", "é•¤"], [92, "U", "é“€"], [93, "Np", "é•"], [94, "Pu", "é’š"], [95, "Am", "é•…"], [96, "Cm", "é””"], [97, "Bk", "é”«"], [98, "Cf", "é”"], [99, "Es", "é”¿"], [100, "Fm", "é•„"], [101, "Md", "é’”"], [102, "No", "é”˜"], [103, "Lr", "é“¹"]
        ];

        const atomicWeights = {
            1: "1.008", 2: "4.0026", 3: "6.94", 4: "9.0122", 5: "10.81", 6: "12.011", 7: "14.007", 8: "15.999", 9: "18.998", 10: "20.180",
            11: "22.990", 12: "24.305", 13: "26.982", 14: "28.085", 15: "30.974", 16: "32.06", 17: "35.45", 18: "39.948", 19: "39.098", 20: "40.078",
            21: "44.956", 22: "47.867", 23: "50.942", 24: "51.996", 25: "54.938", 26: "55.845", 27: "58.933", 28: "58.693", 29: "63.546", 30: "65.38",
            31: "69.723", 32: "72.630", 33: "74.922", 34: "78.971", 35: "79.904", 36: "83.798", 37: "85.468", 38: "87.62", 39: "88.906", 40: "91.224",
            41: "92.906", 42: "95.95", 43: "[98]", 44: "101.07", 45: "102.91", 46: "106.42", 47: "107.87", 48: "112.41", 49: "114.82", 50: "118.71",
            51: "121.76", 52: "127.60", 53: "126.90", 54: "131.29", 55: "132.91", 56: "137.33", 57: "138.91", 58: "140.12", 59: "140.91", 60: "144.24",
            61: "[145]", 62: "150.36", 63: "151.96", 64: "157.25", 65: "158.93", 66: "162.50", 67: "164.93", 68: "167.26", 69: "168.93", 70: "173.05",
            71: "174.97", 72: "178.49", 73: "180.95", 74: "183.84", 75: "186.21", 76: "190.23", 77: "192.22", 78: "195.08", 79: "196.97", 80: "200.59",
            81: "204.38", 82: "207.2", 83: "208.98", 84: "[209]", 85: "[210]", 86: "[222]", 87: "[223]", 88: "[226]", 89: "[227]", 90: "232.04",
            91: "231.04", 92: "238.03", 93: "[237]", 94: "[244]", 95: "[243]", 96: "[247]", 97: "[247]", 98: "[251]", 99: "[252]", 100: "[257]",
            101: "[258]", 102: "[259]", 103: "[266]", 104: "[267]", 105: "[268]", 106: "[269]", 107: "[270]", 108: "[277]", 109: "[278]", 110: "[281]",
            111: "[282]", 112: "[285]", 113: "[286]", 114: "[289]", 115: "[290]", 116: "[293]", 117: "[294]", 118: "[294]"
        };

        const electronConfigs = {
            1: "1s1", 2: "1s2", 3: "1s2 2s1", 4: "1s2 2s2", 5: "1s2 2s2 2p1", 6: "1s2 2s2 2p2", 7: "1s2 2s2 2p3", 8: "1s2 2s2 2p4", 9: "1s2 2s2 2p5", 10: "1s2 2s2 2p6",
            11: "1s2 2s2 2p6 3s1", 12: "1s2 2s2 2p6 3s2", 13: "1s2 2s2 2p6 3s2 3p1", 14: "1s2 2s2 2p6 3s2 3p2", 15: "1s2 2s2 2p6 3s2 3p3", 16: "1s2 2s2 2p6 3s2 3p4", 17: "1s2 2s2 2p6 3s2 3p5", 18: "1s2 2s2 2p6 3s2 3p6",
            19: "1s2 2s2 2p6 3s2 3p6 4s1", 20: "1s2 2s2 2p6 3s2 3p6 4s2", 21: "1s2 2s2 2p6 3s2 3p6 3d1 4s2", 22: "1s2 2s2 2p6 3s2 3p6 3d2 4s2", 23: "1s2 2s2 2p6 3s2 3p6 3d3 4s2", 24: "1s2 2s2 2p6 3s2 3p6 3d5 4s1", 25: "1s2 2s2 2p6 3s2 3p6 3d5 4s2", 26: "1s2 2s2 2p6 3s2 3p6 3d6 4s2", 27: "1s2 2s2 2p6 3s2 3p6 3d7 4s2", 28: "1s2 2s2 2p6 3s2 3p6 3d8 4s2", 29: "1s2 2s2 2p6 3s2 3p6 3d10 4s1", 30: "1s2 2s2 2p6 3s2 3p6 3d10 4s2",
            31: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p1", 32: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p2", 33: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p3", 34: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p4", 35: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p5", 36: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6",
            37: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 5s1", 38: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 5s2", 39: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d1 5s2", 40: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d2 5s2", 41: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d4 5s1", 42: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d5 5s1", 43: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d5 5s2", 44: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d7 5s1", 45: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d8 5s1", 46: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10", 47: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s1", 48: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2",
            49: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p1", 50: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p2", 51: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p3", 52: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p4", 53: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p5", 54: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p6",
            55: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p6 6s1", 56: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p6 6s2",
            57: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 5s2 5p6 5d1 6s2", 58: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f1 5s2 5p6 5d1 6s2", 59: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f3 5s2 5p6 6s2", 60: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f4 5s2 5p6 6s2", 61: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f5 5s2 5p6 6s2", 62: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f6 5s2 5p6 6s2", 63: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f7 5s2 5p6 6s2", 64: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f7 5s2 5p6 5d1 6s2", 65: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f9 5s2 5p6 6s2", 66: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f10 5s2 5p6 6s2", 67: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f11 5s2 5p6 6s2", 68: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f12 5s2 5p6 6s2", 69: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f13 5s2 5p6 6s2", 70: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 6s2", 71: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d1 6s2",
            72: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d2 6s2", 73: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d3 6s2", 74: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d4 6s2", 75: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d5 6s2", 76: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d6 6s2", 77: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d7 6s2", 78: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d9 6s1", 79: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s1", 80: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2",
            81: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p1", 82: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p2", 83: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p3", 84: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p4", 85: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p5", 86: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p6",
            87: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p6 7s1", 88: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p6 7s2",
            89: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p6 6d1 7s2", 90: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 6s2 6p6 6d2 7s2", 91: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f2 6s2 6p6 6d1 7s2", 92: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f3 6s2 6p6 6d1 7s2", 93: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f4 6s2 6p6 6d1 7s2", 94: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f6 6s2 6p6 7s2", 95: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f7 6s2 6p6 7s2", 96: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f7 6s2 6p6 6d1 7s2", 97: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f9 6s2 6p6 7s2", 98: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f10 6s2 6p6 7s2", 99: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f11 6s2 6p6 7s2", 100: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f12 6s2 6p6 7s2", 101: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f13 6s2 6p6 7s2", 102: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 7s2", 103: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 7s2 7p1",
            104: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d2 7s2", 105: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d3 7s2", 106: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d4 7s2", 107: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d5 7s2", 108: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d6 7s2", 109: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d7 7s2", 110: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d8 7s2", 111: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d9 7s2", 112: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d10 7s2", 113: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d10 7s2 7p1", 114: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d10 7s2 7p2", 115: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d10 7s2 7p3", 116: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d10 7s2 7p4", 117: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d10 7s2 7p5", 118: "1s2 2s2 2p6 3s2 3p6 3d10 4s2 4p6 4d10 4f14 5s2 5p6 5d10 5f14 6s2 6p6 6d10 7s2 7p6"
        };

        const tableContainer = document.getElementById('table');
        const infoBar = document.getElementById('info-bar');
        const groupLabelsContainer = document.querySelector('.group-labels');
        
        const groupMap = {
            1: 'IA', 2: 'IIA', 3: 'IIIB', 4: 'IVB', 5: 'VB', 6: 'VIB', 7: 'VIIB',
            8: 'VIII', 9: 'VIII', 10: 'VIII', 11: 'IB', 12: 'IIB',
            13: 'IIIA', 14: 'IVA', 15: 'VA', 16: 'VIA', 17: 'VIIA', 18: '0'
        };

        function generateGroupLabels() {
            groupLabelsContainer.innerHTML = '';
            for (let i = 1; i <= 18; i++) {
                const div = document.createElement('div');
                div.className = 'group-label';
                div.style.setProperty('--col', i);
                let row = 4;
                if (i === 1 || i === 18) row = 1;
                else if ((i >= 2 && i <= 2) || (i >= 13 && i <= 17)) row = 2;
                div.style.setProperty('--row', row);

                div.innerHTML = `
                    <span class="group-num">${i}</span>
                    <span class="group-old">${groupMap[i] || ''}</span>
                `;
                groupLabelsContainer.appendChild(div);
            }
        }

        function createElementBox(num, sym, hanzi, row, col, block, isStair) {
            const div = document.createElement('div');
            div.className = 'element';
            div.style.gridRow = row;
            div.style.gridColumn = col;

            const mass = atomicWeights[num] || "â€”";
            div.setAttribute('role', 'button');
            div.setAttribute('tabindex', '0');
            div.setAttribute('aria-label', `${hanzi} ${sym}`);
            div.setAttribute('data-block', block);
            div.setAttribute('data-group', col);
            div.setAttribute('data-atomic', num);
            if (isStair) div.setAttribute('data-stair', 'true');

            div.innerHTML = `
                <span class="atomic-number">${num}</span>
                <span class="atomic-mass">${mass}</span>
                <span class="symbol">${sym}</span>
                <span class="hanzi">${hanzi}</span>
            `;

            div.onclick = function () { handleElementClick({ num, sym, hanzi, row, col, block }, this); };
            div.onkeydown = function (e) { if (e.key === 'Enter' || e.key === ' ') { e.preventDefault(); this.click(); } };
            div.oncontextmenu = function (e) { e.preventDefault(); this.classList.toggle('is-marked'); return false; };

            return div;
        }

        function formatConfig(config) {
            return config.split(' ').map((token) => {
                const match = token.match(/^(\d+)([spdfg])(\d+)$/);
                if (!match) return token;
                return `<span class="orbital">${match[1]}${match[2]}<sup>${match[3]}</sup></span>`;
            }).join(' ');
        }

        function updateInfo({ num, sym, hanzi, row, col, block }) {
            let periodText = `${row}`;
            const oldGroup = groupMap[col];
            let groupText = oldGroup ? `${col} <span style="opacity:0.6">(${oldGroup})</span>` : `${col}`;
            let blockText = `${block}`;
            const mass = atomicWeights[num] || "Unknown";

            if (block === 'f') {
                periodText = row === 9 ? '6' : '7';
                groupText = row === 9 ? 'é•§ç³»' : 'é”•ç³»';
                blockText = 'f';
            }

            const config = electronConfig(num);
            infoBar.innerHTML = `
                <div style="flex:1; min-width:200px;">
                    <span class="value" style="font-size:24px; color:#2563eb;">${sym}</span>
                    <span class="value" style="font-size:20px;">${hanzi}</span>
                    <span class="mass-highlight">${mass}</span>
                </div>
                <div style="flex:2; display:flex; flex-wrap:wrap; gap:16px;">
                    <div><span class="label">å‘¨æœŸ</span><span class="value">${periodText}</span></div>
                    <div><span class="label">æ—</span><span class="value">${groupText}</span></div>
                    <div><span class="label">åˆ†åŒº</span><span class="value" style="text-transform:uppercase;">${blockText}</span></div>
                    <div><span class="label">æ’å¸ƒ</span><span class="config">${config}</span></div>
                </div>
            `;
        }

        function electronConfig(num) {
            const raw = electronConfigs[num];
            return raw ? formatConfig(raw) : 'â€”';
        }

        function setSelected(el) {
            const prev = document.querySelector('.element.is-selected');
            if (prev) prev.classList.remove('is-selected');
            el.classList.add('is-selected');
            el.focus();
        }

        const defaultInfoHtml = `
            <div style="color:#94a3b8; font-weight:500;">ğŸ‘‹ ç‚¹å‡»å…ƒç´ å¡ç‰‡ï¼Œæ­¤å¤„å°†æ˜¾ç¤ºè¯¦ç»†å±æ€§ (ç”µå­æ’å¸ƒã€æ—ã€å‘¨æœŸç­‰)</div>
        `;

        function renderDefaultInfo() { infoBar.innerHTML = defaultInfoHtml; }

        // Quiz Logic
        const quizElements = [
            ...elementsData.map(([num, sym, hanzi, row, col, block]) => ({ num, sym, hanzi, row, col, block })),
            ...lanthanides.map(([num, sym, hanzi]) => ({ num, sym, hanzi, row: 9, col: null, block: "f" })),
            ...actinides.map(([num, sym, hanzi]) => ({ num, sym, hanzi, row: 10, col: null, block: "f" }))
        ];

        const commonQuizElements = quizElements.filter(el => el.num <= 103);

        const quizModeMap = {
            random_all: { mode: "random", pool: "all", label: "éšæœº (å…¨è¡¨)" },
            symbol_all: { mode: "symbol", pool: "all", label: "ç¬¦å· (å…¨è¡¨)" },
            hanzi_all: { mode: "hanzi", pool: "all", label: "æ±‰å­— (å…¨è¡¨)" },
            common_random: { mode: "random", pool: "common", label: "éšæœº (å¸¸ç”¨)" }
        };

        const quizState = {
            active: false, correct: 0, total: 0, modeSetting: "random",
            promptMode: "symbol", pool: "all", target: null, lastResult: null, modeLabel: "éšæœº (å…¨è¡¨)"
        };

        function getQuizPool() { return quizState.pool === "common" ? commonQuizElements : quizElements; }

        function applyQuizMode(value) {
            const config = quizModeMap[value] || quizModeMap.random_all;
            quizState.modeSetting = config.mode;
            quizState.pool = config.pool;
            quizState.modeLabel = config.label;
        }

        function setQuizMode(value) {
            applyQuizMode(value);
            if (quizState.active) {
                quizState.correct = 0; quizState.total = 0; quizState.lastResult = null;
                nextQuizTarget(); resetTable(true); renderQuizPrompt();
            } else { renderDefaultInfo(); }
        }

        function nextQuizTarget() {
            const pool = getQuizPool();
            const pick = pool[Math.floor(Math.random() * pool.length)];
            quizState.target = pick;
            quizState.promptMode = quizState.modeSetting === "random"
                ? (Math.random() < 0.5 ? "symbol" : "hanzi") : quizState.modeSetting;
        }

        function renderQuizPrompt() {
            if (!quizState.active || !quizState.target) { renderDefaultInfo(); return; }
            const promptLabel = quizState.promptMode === "symbol" ? "ç¬¦å·" : "æ±‰å­—";
            const promptValue = quizState.promptMode === "symbol" ? quizState.target.sym : quizState.target.hanzi;
            const result = quizState.lastResult ? `<span class="quiz-result ${quizState.lastResult.correct ? "is-correct" : "is-wrong"}">${quizState.lastResult.text}</span>` : "";
            
            infoBar.innerHTML = `
                <div style="display:flex; align-items:center; gap:10px;">
                    <span style="font-weight:700; color:#475569;">è¯·ç‚¹å‡»ï¼š</span>
                    <span class="quiz-target">${promptValue}</span>
                    <span style="color:#94a3b8; font-size:12px;">(${promptLabel})</span>
                </div>
                <div style="display:flex; align-items:center;">
                    <span style="font-weight:700; color:#64748b;">${quizState.modeLabel}</span>
                    <span style="margin:0 10px; color:#cbd5e1;">|</span>
                    <span style="font-weight:700; color:#3b82f6;">${quizState.correct}</span>
                    <span style="color:#94a3b8;">/${quizState.total}</span>
                    ${result}
                </div>
            `;
        }

        function handleElementClick(data, element) {
            if (!quizState.active) {
                element.classList.toggle('is-revealed');
                setSelected(element);
                updateInfo(data);
                return;
            }
            quizState.total += 1;
            const isCorrect = data.num === quizState.target.num;
            quizState.lastResult = { correct: isCorrect, text: isCorrect ? "Bingo! ğŸ‰" : `æ­£ç¡®æ˜¯: ${quizState.target.sym} ${quizState.target.hanzi}` };
            if (isCorrect) {
                element.classList.add('is-revealed');
                setSelected(element);
                quizState.correct += 1;
            }
            nextQuizTarget();
            renderQuizPrompt();
        }

        function toggleQuiz() {
            quizState.active = !quizState.active;
            const btn = document.getElementById("btn-quiz");
            const modeSelect = document.getElementById("quiz-mode");
            if (quizState.active) {
                applyQuizMode(modeSelect ? modeSelect.value : "random_all");
                quizState.correct = 0; quizState.total = 0; quizState.lastResult = null;
                nextQuizTarget(); resetTable(true); btn.innerHTML = "ğŸ ç»“æŸ"; btn.classList.add("active"); renderQuizPrompt();
            } else {
                btn.innerHTML = "ğŸ§ª æµ‹éªŒ"; btn.classList.remove("active");
                quizState.lastResult = null; quizState.target = null; renderDefaultInfo();
            }
        }

        function initTable() {
            tableContainer.innerHTML = ''; // æ¸…ç©ºä»¥é˜²é‡ç»˜
            generateGroupLabels(); // ç”ŸæˆåŠ¨æ€æ—æ ‡ç­¾
            
            // ä¸»æ—
            elementsData.forEach(el => {
                tableContainer.appendChild(createElementBox(el[0], el[1], el[2], el[3], el[4], el[5], el[6]));
            });
            // æ ‡ç­¾
            const labelLa = document.createElement('div'); labelLa.className = 'series-label';
            labelLa.style.gridRow = '9'; labelLa.style.gridColumn = '1 / span 3'; labelLa.textContent = 'é•§ç³»';
            tableContainer.appendChild(labelLa);

            const labelAc = document.createElement('div'); labelAc.className = 'series-label';
            labelAc.style.gridRow = '10'; labelAc.style.gridColumn = '1 / span 3'; labelAc.textContent = 'é”•ç³»';
            tableContainer.appendChild(labelAc);

            // é•§ç³» & é”•ç³»
            lanthanides.forEach((el, index) => tableContainer.appendChild(createElementBox(el[0], el[1], el[2], 9, index + 4, "f", false)));
            actinides.forEach((el, index) => tableContainer.appendChild(createElementBox(el[0], el[1], el[2], 10, index + 4, "f", false)));
            
            renderDefaultInfo();
        }

        const container = document.querySelector('.periodic-table-container');

        function toggleGlobal(mode) {
            const btnMap = { 'number': 'btn-num', 'symbol': 'btn-sym', 'hanzi': 'btn-hanzi', 'zones': 'btn-zones', 'staircase': 'btn-stair', 'mass': 'btn-mass' };
            const className = `show-${mode}`;
            container.classList.toggle(className);
            const btn = document.getElementById(btnMap[mode]);
            if (container.classList.contains(className)) btn.classList.add('active'); else btn.classList.remove('active');
        }

        function resetTable(quiet) {
            const classes = ['show-number', 'show-symbol', 'show-hanzi', 'show-zones', 'show-staircase', 'show-mass'];
            classes.forEach(c => container.classList.remove(c));
            document.querySelectorAll('.controls button').forEach(btn => btn.classList.remove('active'));
            if (quizState.active) {
                const quizBtn = document.getElementById("btn-quiz");
                if (quizBtn) quizBtn.classList.add("active");
            }
            const allElements = document.querySelectorAll('.element');
            allElements.forEach(el => {
                el.classList.remove('is-revealed');
                el.classList.remove('is-marked');
                el.classList.remove('is-selected');
            });
            if (!quiet) {
                if (quizState.active) renderQuizPrompt(); else renderDefaultInfo();
            }
        }

        initTable();
    </script>
</body>
</html>
